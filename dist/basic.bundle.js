/*! For license information please see basic.bundle.js.LICENSE.txt */
(()=>{"use strict";function e(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var r in t)e[r]=t[r]}return e}var o=function o(t,r){function n(o,n,c){if("undefined"!=typeof document){"number"==typeof(c=e({},r,c)).expires&&(c.expires=new Date(Date.now()+864e5*c.expires)),c.expires&&(c.expires=c.expires.toUTCString()),o=encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var i in c)c[i]&&(s+="; "+i,!0!==c[i]&&(s+="="+c[i].split(";")[0]));return document.cookie=o+"="+t.write(n,o)+s}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var o=document.cookie?document.cookie.split("; "):[],r={},n=0;n<o.length;n++){var c=o[n].split("="),s=c.slice(1).join("=");try{var i=decodeURIComponent(c[0]);if(r[i]=t.read(s,i),e===i)break}catch(e){}}return e?r[e]:r}},remove:function(o,t){n(o,"",e({},t,{expires:-1}))},withAttributes:function(t){return o(this.converter,e({},this.attributes,t))},withConverter:function(t){return o(e({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const t=1e3,r="https://avt-sv-api-16ae49589f38.herokuapp.com/players",n=2;let c,s=t,i=!1;console.log("starting players_basic.js");const a=Cookies.get("accessToken");a||window.location.replace("/");const l=document.getElementById("sign-out");document.getElementById("video-source").setAttribute("src",`${star_loop_uri}`),console.log(`signed into players_basic with accessToken: ${a}`),l&&l.addEventListener("click",(()=>{console.log("signout clicked"),c&&clearTimeout(c),i=!1,document.querySelector(".trackInfo").innerHTML="",document.querySelector(".artworkContainer").innerHTML="",console.log("clearing cookies and resetting path"),o.remove("accessToken"),o.remove("refreshToken"),o.remove("expiresAt"),o.remove("email"),o.remove("displayName"),console.log("cleared cookies, testing now"),console.log(`all Cookies: ${JSON.stringify(o.get())}`),console.log(`accessToken: ${o.get("accessToken")}`),console.log(`expiresAt: ${o.get("expiresAt")}`),console.log("exiting cookies and resetting path"),window.location.search=""})),i=!0,function e({prevTitle:a,prevArtist:l,prevAlbum:u}){console.log("polling api"),setTimeout((async()=>{if(!i)return;const{title:p,artist:g,album:d,artworkURL:m,error:f}=await async function(){2===n&&console.log("starting getCurrentTrackFromSpotify");const e=(i={accessToken:o.get("accessToken"),refreshToken:o.get("refreshToken")},Object.keys(i).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(i[e]))).join("&")),c=`${r}?${e}`;var i;2===n&&console.log(`query: ${c}`);const a=await fetch(c).catch((e=>{console.log(`ERROR failed fetch !!!\nError: ${JSON.stringify(e)}`)}));if(!a)return void console.log("response from api was undefined");if(!a.ok){const e=`An error occurred: ${a.statusText}`;return void console.log(`no response from server, tell AVT!\t${e}`)}const{title:l,artist:u,album:p,artworkURL:g,backOff:d,newAccessToken:m,newExpiresAt:f}=await a.json();return d?s*=2:s=t,m&&(o.remove("accessToken"),o.set("accessToken",m),console.log(`updated accessToken to: ${m}`)),f&&(o.remove("expiresAt"),o.set("expiresAt",f),console.log(`updated expiredAt to: ${f}`)),2===n&&console.log("exiting getCurrentTrackFromSpotify"),{title:l,artist:u,album:p,artworkURL:g,error:void 0}}();f&&console.log(`ERROR getting currentTrack: ${f}`),p===a&&g===l&&d===u||function({title:e,artist:o,album:t,artworkURL:r}){console.log("updating Track Info"),document.querySelector(".trackInfo").innerHTML=`\n      <p>Track: ${e}</p>\n      <p>Artist: ${o}</p>\n      <p>Album: ${t}</p>\n  `,document.querySelector(".artworkContainer").innerHTML=`\n     <img\n         class=artwork\n         src=${r}\n         alt="album art"\n     />\n  `,console.log("done updating Track Info")}({title:p,artist:g,album:d,artworkURL:m}),c=setTimeout((()=>{e({prevTitle:p,prevArtist:g,prevAlbum:d})}),s)}),s)}({prevTitle:"",prevArtist:"",prevAlbum:""}),console.log("leaving players_basic.js")})();