(()=>{"use strict";function o(o){window.location.replace(function(o){const e=window.location.href.toString();console.log(`originURL: ${e}`);const n=e.split(o)[0];return console.log(`newURL: ${n}`),n}(o))}const e=1e3,n="https://avt-sv-api-16ae49589f38.herokuapp.com/visualizers",t=2,r="userData";function s(){2===t&&console.log("getting userData from localStorage");const o=window.localStorage.getItem(r);if(!o)return console.log("could not find userData in local storage, returning undefined"),{accessToken:void 0,refreshToken:void 0,expiresAt:void 0,email:void 0,displayName:void 0};const e=JSON.parse(o);return 2===t&&(console.log("userData pulled from localStorage: ",e),console.log("returning from getUserData")),e}function i({accessToken:o,refreshToken:e,expiresAt:n,email:i,displayName:l}){2===t&&console.log("updatingUserData");const c=s();o&&(c.accessToken=o),e&&(c.refreshToken=e),n&&(c.expiresAt=n),i&&(c.email=i),l&&(c.displayName=l),t>=1&&console.log("updating localStorage userData to ",c),window.localStorage.setItem(r,JSON.stringify(c))}let l,c,a=e,g=!1,u=null;console.log("starting players_basic.js");const{accessToken:k,refreshToken:p}=s();k||(console.log("No accessToken found"),console.log("exiting login.js"),o("/visualizers/basic")),p||(console.log("No refreshToken found"),console.log("exiting login.js"),o("/visualizers/basic"));const d=document.createElement("source");var f,y;d.setAttribute("type","video/webm"),d.setAttribute("crossOrigin","anonymous"),d.setAttribute("src","./../assets/star_loop_10x.webm"),document.getElementById("video-player").appendChild(d),console.log(`signed into players_basic with accessToken: ${k}\n and refreshToken: ${p}`),f=k,y=p,console.log("initial accessToken",f),console.log("initial refreshTOken",y),l=f,c=y,g=!0,async function o({prevSpotifyTrackLink:r}){if(2===t&&console.log("polling api"),console.log("accessToken",l),console.log("refreshTOken",c),!g)return void console.log("continuePolling is false");const{title:s,artist:k,album:p,artworkURL:d,spotifyTrackLink:f,currentlyPlayingNothing:y,error:m}=await async function(){2===t&&console.log("starting getCurrentTrackFromSpotify");const o=(r={accessToken:l,refreshToken:c},Object.keys(r).map((o=>encodeURIComponent(o)+"="+encodeURIComponent(r[o]))).join("&"));var r;const s=`${n}?${o}`;2===t&&console.log(`query: ${s}`);const g=await fetch(s).catch((o=>{console.log(`ERROR failed fetch !!!\nError: ${JSON.stringify(o)}`)}));if(!g)return void console.log("response from api was undefined");if(!g.ok){const o=`An error occurred: ${g.statusText}`;return void console.log(`no response from server, tell AVT!\t${o}`)}const{title:u,artist:k,album:p,artworkURL:d,spotifyTrackLink:f,backOff:y,currentlyPlayingNothing:m,newAccessToken:T,newExpiresAt:w,error:v}=await g.json();return m?{artworkURL:d,currentlyPlayingNothing:m}:v?{error:v}:(y?a*=2:a=Math.max(.95*a,e),T&&(console.log(`recieved updated accessToken: ${T}`),i({accessToken:T}),l=T),w&&(console.log(`received updated expiredAt: ${w}`),i({expiredAt:w})),2===t&&console.log("exiting getCurrentTrackFromSpotify"),{title:u,artist:k,album:p,artworkURL:d,spotifyTrackLink:f})}();y&&console.log("\n\n\tERROR: currentlyPlayingNothing\n\n"),m&&console.log(`\n\tERROR: ${m}\n`),f===r||m||function({title:o,artist:e,album:n,artworkURL:t,spotifyTrackLink:r,currentlyPlayingNothing:s}){console.log(`Updating Track Info to\n--\n\t${o}\n\t${e}\n\t${n}\n\t${t}\n--`),document.querySelector(".trackInfo").innerHTML=o&&e&&n?`\n      <p>Track: ${o}</p>\n      <p>Artist: ${e}</p>\n      <p>Album: ${n}</p>\n  `:"",s&&(document.querySelector(".trackInfo").innerHTML=`\n      <p>${s}\n    `),document.querySelector(".artworkContainer").innerHTML=t?`\n        <img\n           class=artwork\n           src=${t}\n           alt="album art"\n       />\n  `:"",r&&document.getElementById("spotify-linkback-button").addEventListener("click",(()=>{console.log("linkback clicked!"),console.log(`linkback: ${r}`),window.location.assign(r)}))}({title:s,artist:k,album:p,artworkURL:d,spotifyTrackLink:f,currentlyPlayingNothing:y}),u=setTimeout((()=>{o({prevSpotifyTrackLink:f})}),a)}({prevSpotifyTrackLink:""}),console.log("leaving players_basic.js")})();