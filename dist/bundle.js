(()=>{var e={660:e=>{var t={set:function(e){if(e.name=e.name||!1,e.value=e.value||"",e.exdays=e.exdays||!1,e.path=e.path||"/",e.domain=e.domain||!1,e.name){var t=e.domain?"domain="+e.domain+";":"",o="path="+e.path,n="";if(e.exdays){var r=new Date;r.setTime(r.getTime()+24*e.exdays*60*60*1e3),n="expires="+r.toUTCString()}return document.cookie=e.name+"="+e.value+";"+t+o+";"+n,!0}return!1},get:function(e){for(var t=e+"=",n=document.cookie.split(";"),r=null,a=null,s=0;s<n.length;s++){for(r=n[s];" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return(a=r.substring(t.length,r.length)).split("&").length>1?o(a):a}return!1},del:function(e){return e=e||!1,t.set({name:e,value:null,exdays:-1,path:null,domain:null})}};function o(e){for(var t=e.split("&"),o={},n=null,r=0;r<t.length;r++)(n=t[r].split("=")).length>1&&(o[n[0]]=n[1]);return o}e.exports=t}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,o),a.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=o(660),t=o.n(e);let n=INITIAL_POLLING_INTERVAL;console.log("starting main.js"),function(){const e=window.location.search,o=new URLSearchParams(e);console.log("starting queryParamsIntoCookies");const n=o.get("accessToken"),r=o.get("refreshToken"),a=o.get("expiresAt"),s=o.get("email"),l=o.get("displayName");n&&t().set({name:"accessToken",value:n,path:"/"}),r&&t().set({name:"refreshToken",value:r,path:"/"}),a&&t().set({name:"expiresAt",value:a,path:"/"}),s&&t().set({name:"email",value:s,path:"/"}),l&&t().set({name:"displayName",value:l,path:"/"}),2===LOGGING_LEVEL&&(console.log(`accessToken: ${t().get("accessToken")}`),console.log(`refreshToken: ${t().get("refreshToken")}`),console.log(`expiresAt: ${t().get("expiresAt")}`),console.log(`email: ${t().get("email")}`),console.log(`displayName: ${t().get("displayName")}`),console.log("exiting queryParamsIntoCookies"))}();const r=t().get("accessToken");if(r){console.log(`signed in with accessToken: ${r}`);const e=document.querySelector(".sign-in");e&&(e.remove(),console.log("sign-in removed!")),function e({prevTitle:o,prevArtist:r,prevAlbum:a}){console.log("polling api"),setTimeout((async()=>{const{title:s,artist:l,album:i,artworkURL:c,error:u}=await async function(){2===LOGGING_LEVEL&&console.log("starting getCurrentTrackFromSpotify");const e=(r={accessToken:t().get("accessToken"),refreshToken:t().get("refreshToken")},Object.keys(r).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(r[e]))).join("&")),o=`${API_PLAYERS_URL}?${e}`;var r;2===LOGGING_LEVEL&&console.log(`query: ${o}`);const a=await fetch(o).catch((e=>{console.log(`ERROR failed fetch !!!\nError: ${JSON.stringify(e)}`)}));if(!a)return void console.log("response from api was undefined");if(!a.ok){const e=`An error occurred: ${a.statusText}`;return void console.log(`no response from server, tell AVT!\t${e}`)}const{title:s,artist:l,album:i,artworkURL:c,backOff:u,newAccessToken:g,newExpiresAt:p}=await a.json();return u?n*=2:n=INITIAL_POLLING_INTERVAL,g&&(t().set({name:"accessToken",value:g,path:"/"}),console.log(`updated accessToken to: ${g}`)),p&&(t().set({name:"expiresAt",value:p,path:"/"}),console.log(`updated expiredAt to: ${p}`)),2===LOGGING_LEVEL&&console.log("exiting getCurrentTrackFromSpotify"),{title:s,artist:l,album:i,artworkURL:c,error:void 0}}();u&&console.log(`ERROR getting currentTrack: ${u}`),s===o&&l===r&&i===a||function({title:e,artist:t,album:o,artworkURL:n}){console.log("updating Track Info"),document.querySelector(".trackInfo").innerHTML=`\n      <p>Track: ${e}</p>\n      <p>Artist: ${t}</p>\n      <p>Album: ${o}</p>\n  `,document.querySelector(".artworkContainer").innerHTML=`\n     <img\n         class=artwork\n         src=${n}\n         alt="album art"\n     />\n  `}({title:s,artist:l,album:i,artworkURL:c}),setTimeout((()=>{e({prevTitle:s,prevArtist:l,prevAlbum:i})}),n)}),n)}({prevTitle:"",prevArtist:"",prevAlbum:""})}else console.log("no accessToken found");console.log("exiting main.js")})()})();